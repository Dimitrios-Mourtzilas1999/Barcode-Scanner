{% extends "base.html" %}


{%block css %}
<link rel="stylesheet" href="{{url_for('static',filename='css/bootstrap.min.css')}}">
<link rel="stylesheet" href="{{url_for('static',filename='css/dashboard.css')}}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

{%endblock%}

{%block js %}
<script src="{{url_for('static',filename='js/dashboard.js')}}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
{%endblock%}

{%block content%}
{%include 'menu.html'%}
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flashes container mt-3">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}



{%include 'user-nav.html'%}

{%if message %}
<div class="message">

</div>

{%endif%}

<div class="product-actions hidden" id="productActions">
  <button id="assignBtn" class="btn btn-assign" aria-label="Assign product to category">
    <i class="fa fa-exchange-alt" aria-hidden="true"></i>
    <span>Ανάθεση προϊόντος σε Κατηγορία</span>
  </button>

  <button class="btn btn-delete" aria-label="Delete product">
    <i class="fa fa-trash" aria-hidden="true"></i>
    <span>Διαγραφή Προϊόντος</span>
  </button>
</div>

<div class="filters-modal" id="filtersModal">
    <input type="text" name="barcode" id="barcode-input" placeholder="Αναζητηση κωδικού" value="{{request.form.barcode if request.method == 'POST' else ''}}">
    {%for category in categories %}
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" name="category_filter" id="category_{{category.id}}" value="{{category.id}}">
            <label class="form-check-label" for="category_{{category.id}}">{{category.cat_type}}</label>
        </div>
    {%endfor%}
    <button type="submit" class="btn btn-primary apply-filters">Αναζητηση</button>
</div>

<div class="modal fade" id="assignModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="assignForm" method="POST" action="{{ url_for('category.assign_to_category') }}">
        {{ form.hidden_tag() }}

        <div class="modal-header">
          <h5 class="modal-title">Ανάθεση Προϊόντων σε Κατηγορία</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <label class="form-label">{{ form.categories.label.text }}</label>
          {{ form.categories(id='category-assign', class="form-select") }}

          <input type="hidden" name="barcodes" id="modal-barcodes">
        </div>

        <div class="modal-footer">
          {{ form.submit(class="btn btn-primary") }}
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Άκυρο</button>
        </div>
      </form>
    </div>
  </div>
</div>



<div class="actions-wrapper">
      <div class="filters" id="filters">
        <i class="fa fa-filter"></i>
      </div>

</div>

                <div id="Main_Table" class="app">
            <table id="dashboard">
                    <thead id="table-header">
                        <tr style="user-select: none;">
                            <th>
                                <div class="checkbox-wrapper-31">
                                    <input type="checkbox" id="main-input">
                                    <svg viewBox="0 0 35.6 35.6">
                                    <circle class="background" cx="17.8" cy="17.8" r="17.8"></circle>
                                    <circle class="stroke" cx="17.8" cy="17.8" r="14.37"></circle>
                                    <polyline class="check" points="11.78 18.12 15.55 22.23 25.17 12.87"></polyline>
                                    </svg>
                                </div>
                            </th>
                            <th >A.A</th>
                            <th>
                                <div id="" class="sort-div">
                                    Barcode
                                        <button id="sort_barcode_paralavis" class="btn sort-icon" onclick="sortRecords(this)">
                                                <i class="fa-solid fa-sort "></i>
                                        </button>
                                </div> 
                            </th>
                            <th>
                                <div id="" class="sort-div">
                                    ΠΕΡΙΓΡΑΦΗ ΠΡΟΪΟΝΤΟΣ
                                        <button id="sort_rgs_name" class="btn sort-icon" onclick="sortRecords(this)">
                                                <i class="fa-solid fa-sort "></i>
                                        </button>
                                </div> 
                            </th>
                            <th>ΑΠΟΘΕΜΑ</th>
                            <!-- <th>ΤΟΜΟΣ</th> -->
                             <th>
                                <div id="" class="sort-div">
                                    ΤΙΜΗ
                                        <button id="sort_volume" class="btn sort-icon" onclick="sortRecords(this)">
                                                <i class="fa-solid fa-sort "></i>
                                        </button>
                                </div>
                            </th>
                            <th>
                                <div id="" class="sort-div">
                                    ΕΝΗΜΕΡΩΘΗΚΕ
                                        <button id="sort_collect_date" class="btn sort-icon" onclick="sortRecords(this)">
                                                <i class="fa-solid fa-sort "></i>
                                        </button>
                                </div> 
                            </th>
                            <th>
                                <div id="" class="sort-div">
                                    ΚΑΤΗΓΟΡΙΑ
                                        <button id="sort_collect_date" class="btn sort-icon" onclick="sortRecords(this)">
                                                <i class="fa-solid fa-sort "></i>
                                        </button>
                                </div> 
                            </th>
                            <th>
                                <div id="" class="sort-div">
                                    ΠΡΟΜΗΘΕΥΤΗΣ
                                        <button id="sort_collect_date" class="btn sort-icon" onclick="sortRecords(this)">
                                                <i class="fa-solid fa-sort "></i>
                                        </button>
                                </div> 
                            </th>
                        </tr>
                    </thead>
                    <tbody id="names">
                        {% for product in products %}

                            {% set indx =  loop.index0 + 1 %}

                      <tr id="hover-element">
                        <td>
                            <div class="checkbox-wrapper-31">
                                <input class="barcode" type="checkbox" value="{{product.barcode}}" id="barcode-checkbox">
                                <svg viewBox="0 0 35.6 35.6">
                                <circle class="background" cx="17.8" cy="17.8" r="17.8"></circle>
                                <circle class="stroke" cx="17.8" cy="17.8" r="14.37"></circle>
                                <polyline class="check" points="11.78 18.12 15.55 22.23 25.17 12.87"></polyline>
                                </svg>
                            </div>
                        </td>
                        <td>{{indx}}</td>
                        <td><a href="{{url_for('product.edit_product', brcd=product.barcode)}}">{{product.barcode}}</a></td>
                        <td>{{product.desc}}</td>
                        <td>{{product.price}}</td>
                        <td>{{product.stock}}</td>
                        <td>{{product.updated_at if product.updated_at else ''}}</td>
                        <td>{{product.supplier.name if product.supplier else ''}}</td>
                        <td>{{product.category.cat_type if product.category else ''}}</td>
                      </tr>
                        {% endfor %}
                    </tbody>
                    </table>
                </div>


{%include 'pagination.html'%}

{%include 'copyright.html'%}

{%endblock%}