{% extends "base.html" %}


{%block css %}
<link rel="stylesheet" href="{{url_for('static',filename='css/bootstrap.min.css')}}">
<link rel="stylesheet" href="{{url_for('static',filename='css/dashboard.css')}}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

{%endblock%}

{%block js %}
<script src="{{url_for('static',filename='js/dashboard.js')}}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.js"></script>
{%endblock%}

{%block content%}
{%include 'menu.html'%}

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flashes container mt-3">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}


{%if message %}
<div class="message">

</div>

{%endif%}

<div class="product-actions hidden" id="productActions">
  <button id="assignBtn" class="btn btn-assign" aria-label="Assign product to category">
    <i class="fa fa-exchange-alt" aria-hidden="true"></i>
    <span>Ανάθεση προϊόντος σε Κατηγορία</span>
  </button>

  <button class="btn btn-delete" aria-label="Delete product">
    <i class="fa fa-trash" aria-hidden="true"></i>
    <span>Διαγραφή Προϊόντος</span>
  </button>
</div>


<div class="filters" id="filters">
  <i class="fa fa-filter"></i>
</div>


<div class="filters-modal" id="filtersModal">
    <span class="close">&times;</span>
    <form method="POST" class="filtersForm">
      <input type="text" name="barcode" id="barcode-input" placeholder="Αναζητηση κωδικού" value="{{request.form.barcode if request.method == 'POST' else ''}}">
      <div class="category-wrapper">
        <label for="category">Κατηγορια</label>
        <select name="category" id="category-select">
          {%for category in categories %}
            <option value="{{ category.id }}">{{ category.cat_type }}
            </option>
          {%endfor%}
        </select>
    
      </div>

      <div class="supplier-wrapper">
        <label for="supplier">Προμηθευτης</label>
        <select name="supplier" id="supplier-select">
        {%for supplier in suppliers %}
        <option value="{{supplier.id}}">{{supplier.name}}</option>
        {%endfor%}
        </select>
      </div>

      <button class="btn btn-primary apply-filters">Αναζητηση</button>
    </form>
</div>

<div class="modal fade" id="assignModal" tabindex="-1" aria-labelledby="assignModalLabel" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="assignForm" method="POST" action="{{url_for('category.assign_to_category')}}">
        {{ form.hidden_tag() }}

        <div class="modal-header">
          <h5 class="modal-title" id="assignModalLabel">Ανάθεση Προϊόντων σε Κατηγορία</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <label class="form-label" for="category-assign">{{ form.categories.label.text }}</label>
          {{ form.categories(id='category-assign', class="form-select") }}

          <input type="hidden" name="barcodes" id="modal-barcodes">
        </div>

        <div class="modal-footer">
          {{ form.submit(id="assignSubmit", type="submit") }}
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Άκυρο</button>
        </div>
      </form>
    </div>
  </div>
</div>



<div id="Main_Table" class="app">
<table id="dashboard">
    <thead id="table-header">
        <tr style="user-select: none;">
            <th>
              <input type="checkbox" id="selectAll" style="cursor: pointer;" class="select-all">
            </th>
            <th>A.A</th>
            <th>
                <div class="sort-div">
                    Barcode
                    <button id="barcode" class="btn sort-icon">
                        <i class="fa-solid fa-sort"></i>
                    </button>
                </div> 
            </th>
            <th>
                <div class="sort-div">
                    ΠΕΡΙΓΡΑΦΗ ΠΡΟΪΟΝΤΟΣ
                    <button id="desc" class="btn sort-icon">
                        <i class="fa-solid fa-sort"></i>
                    </button>
                </div> 
            </th>
            <th>
                <div class="sort-div">
                    ΑΠΟΘΕΜΑ
                    <button id="stock" class="btn sort-icon">
                        <i class="fa-solid fa-sort"></i>
                    </button>
                </div>
            </th>
            <th>
                <div class="sort-div">
                    ΤΙΜΗ
                    <button id="price" class="btn sort-icon">
                        <i class="fa-solid fa-sort"></i>
                    </button>
                </div>
            </th>
            <th>
                <div class="sort-div">
                    ΕΝΗΜΕΡΩΘΗΚΕ
                    <button id="updated_at" class="btn sort-icon">
                        <i class="fa-solid fa-sort"></i>
                    </button>
                </div> 
            </th>
            <th>
                <div class="sort-div">
                    ΚΑΤΗΓΟΡΙΑ
                    <button id="category" class="btn sort-icon">
                        <i class="fa-solid fa-sort"></i>
                    </button>
                </div> 
            </th>
            <th>
                <div class="sort-div">
                    ΠΡΟΜΗΘΕΥΤΗΣ
                    <button id="supplier" class="btn sort-icon">
                        <i class="fa-solid fa-sort"></i>
                    </button>
                </div> 
            </th>
        </tr>
    </thead>
    <tbody id="names">
        {% for product in products %}
        {% set indx = loop.index0 + 1 %}
        <tr>
            <td><input type="checkbox" name="barcodes" value="{{product.barcode}}"></td>
            <td>{{ indx }}</td>
            <td>{{ product.barcode }}</td>
            <td>{{ product.desc }}</td>
            <td>{{ product.stock }}</td>
            <td>{{ product.price }}</td>
            <td>{{ product.date_updaterd }}</td>
            <td>{{ product.category.cat_type if product.category else '-' }}</td>
            <td>{{ product.supplier.name  if product.supplier else '-'}}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
  </div>

{%include 'pagination.html'%}

{%include 'copyright.html'%}

{%endblock%}