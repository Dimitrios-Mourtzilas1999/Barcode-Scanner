{% extends "base.html" %}


{%block css %}
<link rel="stylesheet" href="{{url_for('static',filename='css/bootstrap.min.css')}}">
<link rel="stylesheet" href="{{url_for('static',filename='css/dashboard.css')}}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

{%endblock%}

{%block js %}
<script src="{{url_for('static',filename='js/dashboard.js')}}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
{%endblock%}

{%block content%}
{%include 'menu.html'%}
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flashes container mt-3">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}



{%include 'user-nav.html'%}

{%if message %}
<div class="message">

</div>

{%endif%}

<div class="product-actions hidden" id="productActions">
  <button id="assignBtn" class="btn btn-assign" aria-label="Assign product to category">
    <i class="fa fa-exchange-alt" aria-hidden="true"></i>
    <span>Ανάθεση προϊόντος σε Κατηγορία</span>
  </button>

  <button class="btn btn-delete" aria-label="Delete product">
    <i class="fa fa-trash" aria-hidden="true"></i>
    <span>Διαγραφή Προϊόντος</span>
  </button>
</div>

<div class="modal fade" id="filterModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">

      <form id="filterForm" method="POST"> 

        <div class="modal-header">
          <h5 class="modal-title">Φίλτρα</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <div class="actions-container">

            <div class="categories-container">
              <label for="category" class="form-label">Κατηγορίες</label>
              <select name="category" id="category" class="form-select">
                {% for id, name in categories.items() %}
                <option value="{{ name }}">{{ name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="barcode-searcher">
              <input type="text" id="barcode" placeholder="Αναζήτηση Barcode" name="barcode">
              <!-- <a href="#" id="barcodeSearchBtn">
                  <i class="fa fa-search"></i>
              </a> -->
            </div>
            <div class="suppliers">
              <label for="supplier" class="form-label">Προμηθευτές</label>
              <select name="supplier" id="supplier" class="form-select">
                {% for id, name in suppliers.items() %}
                <option value="{{ id }}">{{ name }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-primary apply-filters">Apply Filters</button>
          <button type="button" class="btn btn-warning" id="resetFilters">Reset Filters</button>

        </div>

      </form>

    </div>
  </div>
</div>



<div class="modal fade" id="assignModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="assignForm" method="POST" action="{{ url_for('category.assign_to_category') }}">
        {{ form.hidden_tag() }}

        <div class="modal-header">
          <h5 class="modal-title">Ανάθεση Προϊόντων σε Κατηγορία</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <label class="form-label">{{ form.categories.label.text }}</label>
          {{ form.categories(id='category-assign', class="form-select") }}

          <input type="hidden" name="barcodes" id="modal-barcodes">
        </div>

        <div class="modal-footer">
          {{ form.submit(class="btn btn-primary") }}
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Άκυρο</button>
        </div>
      </form>
    </div>
  </div>
</div>



<div class="actions-wrapper">
      <div class="filters" id="filters">
        <i class="fa fa-filter"></i>
      </div>

</div>

<div class="table-container">
    <table class="modern-table" id="productTable">
        <thead>
            <tr>
              <th><input type="checkbox" id="selectAll" name="barcodes"></th>
              <th data-sort="barcode">BARCODE <span class="sort-icon"></span></th>
              <th data-sort="desc">ΠΕΡΙΓΡΑΦΗ <span class="sort-icon"></span></th>
              <th data-sort="stock">ΑΠΟΘΕΜΑ <span class="sort-icon"></span></th>
              <th data-sort="price">ΤΙΜΗ <span class="sort-icon"></span></th>
              <th data-sort="updated">ΕΝΗΜΕΡΩΘΗΚΕ <span class="sort-icon"></span></th>
              <th data-sort="category">ΚΑΤΗΓΟΡΙΑ <span class="sort-icon"></span></th>                
              <th data-sort="supplier">ΠΡΟΜΗΘΕΥΤΗΣ <span class="sort-icon"></span></th>                
            </tr>
        </thead>
        <tbody>
            {%for product in products%}
            <tr>
                <td>
                  <input type="checkbox" name="barcodes" value="{{product.barcode}}" class="product-checkbox">
                </td>
                <td><a href="{{url_for('product.edit_product',barcode=product.barcode)}}">
                  {{product.barcode}}
                </a> </td>
                <td>{{product.desc}}</td>
                <td>{{product.stock}}</td>
                <td>{{product.price}}€</td>
                <td>{{product.date_updated.strftime('%Y-%m-%d') if product.date_updated else '-'}}</td>
                <td>{{product.category.cat_type if product.category else '-'}}</td>
                <td>{{product.supplier_id if product.supplier else '-'}}</td>
            </tr>
            {%endfor%}
        </tbody>
    </table>
</div>


{%include 'pagination.html'%}

{%include 'copyright.html'%}

{%endblock%}